!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["react","prop-types"],e):"object"==typeof exports?exports["r-audio"]=e(require("react"),require("prop-types")):t["r-audio"]=e(t.react,t["prop-types"])}(window,function(t,e){return function(t){var e={};function n(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(s,i,function(e){return t[e]}.bind(null,i));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(e,n){e.exports=t},function(t,n){t.exports=e},function(t,e,n){"use strict";n.r(e);var s=n(0),i=n.n(s),o=n(1),r=n.n(o);class a extends i.a.Component{componentWillMount(){if(!this.context.audio)throw new ReferenceError("RComponent needs to be a child of a RAudioContext")}render(){return null}}if(a.contextTypes={audio:r.a.instanceOf(window.AudioContext||window.webkitAudioContext),nodes:r.a.instanceOf(Map),debug:r.a.bool},window.AudioContext=window.AudioContext||window.webkitAudioContext||null,!window.AudioContext)throw new Error("Could not find AudioContext. This may be because your browser does not support Web Audio.");class p extends i.a.Component{constructor(t){super(t),this.nodes=new Map,this._context=new AudioContext(t.options),this.props.onInit&&this.props.onInit(this._context),this.props.debug&&(window.RAudioNodeMap=this.nodes)}componentWillMount(){this._context.resume()}getChildContext(){return{audio:this._context,debug:this.props.debug,nodes:this.nodes}}componentWillUnmount(){this._context.suspend()}render(){const t=i.a.Children.toArray(this.props.children).map(t=>{if(!a.isPrototypeOf(t.type))return t;const e={destination:()=>this._context.destination,identifier:Symbol(t.type.name)};return i.a.cloneElement(t,e)});return this.props.debug?i.a.createElement("div",null,t):t||[]}}p.childContextTypes={audio:r.a.instanceOf(AudioContext),nodes:r.a.instanceOf(Map),debug:r.a.bool};class d extends a{constructor(t){super(t),this.node=null,this.params={},this.connectToAllDestinations=this.connectToAllDestinations.bind(this),this.setParam=this.setParam.bind(this)}flattenPointers(t,e=[]){for(let n of t)Array.isArray(n)?this.flattenPointers(n,e):"symbol"==typeof n?e.push(this.context.nodes.get(n)):e.push(n);return e}getConnectionArguments(t,e,n,s=0,i=0){return[n?t[n]:t].concat(n?[]:[s,i])}connectToAllDestinations(t,e){if(e.disconnect(),t&&!this.props.disconnected){let n=t();n instanceof Array||(n=[n]),this.flattenPointers(n).forEach((t,n)=>{if(t){const s=this.getConnectionArguments(t,n,this.props.connectToParam,this.props.connectFromChannel,this.props.connectToChannel);e.connect(...s)}})}}componentWillMount(){super.componentWillMount()}componentWillReceiveProps(t){this.updateParams(t)}componentWillUpdate(t,e){this.props.identifier!==t.identifier&&(this.context.nodes.delete(this.props.identifier),this.context.nodes.set(t.identifier,this.node))}componentDidUpdate(t,e){t.destination!==this.props.destination&&this.connectToAllDestinations(this.props.destination,this.node)}componentWillUnmount(){this.node.disconnect(),this.context.nodes.delete(this.props.identifier)}resolveTransitionProps(t,e){return["number"==typeof t.transitionTime?t.transitionTime:t.transitionTime?t.transitionTime[e]:null,"string"==typeof t.transitionCurve?t.transitionCurve:t.transitionCurve?t.transitionCurve[e]:null]}updateParams(t){if(this.params)for(let e in this.params){if(!(e in t))continue;const[n,s]=this.resolveTransitionProps(t,e);if(this.node[e]instanceof AudioParam)this.setParam(this.node[e],t[e],n,s);else if(this.node.parameters&&this.node.parameters.has(e)){let i=this.node.parameters.get(e);this.setParam(i,t[e],n,s)}else if(e in this.node)try{this.node[e]!==t[e]&&(this.node[e]=t[e])}catch(t){console.warn(`Tried setting ${e} on node`,this.node)}}}setParam(t,e,n,s){if(s){const i=`${s}RampToValueAtTime`;try{t[i](e,n)}catch(s){t.linearRampToValueAtTime(e,n)}}else t.setValueAtTime(e,n||this.context.audio.currentTime)}componentDidMount(){this.connectToAllDestinations(this.props.destination,this.node)}render(){return this.context.debug?i.a.createElement("div",null,i.a.createElement("div",null,i.a.createElement("strong",null,i.a.createElement("em",null,this.props.name||""),i.a.createElement("sup",null,i.a.createElement("mark",null,this.props.disconnected?"disconnected":""))),i.a.createElement("div",null,this.props.connectToParam?i.a.createElement("span",null," connects to ",i.a.createElement("em",null,this.props.connectToParam)):null)),Object.keys(this.params).map((t,e)=>{if(!this.props[t]&&0!==this.props[t])return null;let n=this.props[t];return"boolean"==typeof this.props[t]&&(n=this.props[t].toString()),["number","string","boolean"].includes(typeof this.props[t])||(n=n.constructor.name),i.a.createElement("li",{key:e},t,": ",i.a.createElement("code",null,n))})):null}}class h extends d{componentWillUnmount(){if(super.componentWillUnmount(),this.props.parent){const t=this.props.parent();this.flattenPointers(t).forEach((t,e)=>{const n=this.context.nodes.get(t);if(n)try{n.disconnect(this.node)}catch(t){console.warn(t)}})}}}const c=["RSplit","RCycle","RSplitChannels","RPipeline"],u=t=>h.isPrototypeOf(t.type)||c.includes(t.type.name)||"RExtensible"===Object.getPrototypeOf(t.type).name,l=(t,e)=>n=>isNaN(t.props[n])?e.props[n]:t.props[n];class m extends a{constructor(t){super(t),this.resolveDestination=this.resolveDestination.bind(this),this.resolvePointer=this.resolvePointer.bind(this),this.resolveParent=this.resolveParent.bind(this)}resolvePointer(t){let e=t;return t instanceof Array&&(e=t.map(t=>this.context.nodes.get(t)||t)),e}resolveDestination(t,e){let n=null;if(t===e.length-1)n=(()=>this.props.destination());else if(u(e[t+1].component))n=(()=>this.resolvePointer(this.context.nodes.get(e[t+1].identifier)));else{let s=t+1;for(;e[++s]&&!u(e[s].component););n=s!==t+1&&e[s]?()=>this.resolvePointer(this.context.nodes.get(e[s].identifier)):()=>this.props.destination()}return n}resolveParent(t,e){if(0===t)return this.getParent||null;{const n=e.slice(0,t),s=[];let i=n.pop();if(a.isPrototypeOf(i.component.type)){if(s.push(i.identifier),u(i.component))return()=>s;i=n.pop()}for(;i&&!u(i.component)&&a.isPrototypeOf(i.component.type);)s.push(i.identifier),i=n.pop();return()=>s}}createIdentifiedChild(t){const e={component:t,identifier:Symbol(t.type.name+Date.now())};return!this.foundFirstConnectableType&&u(t)&&(e.identifier=this.props.identifier,this.foundFirstConnectableType=!0),e}createEmbeddableChild(t,e,n){if(!a.isPrototypeOf(t.component.type))return t.component;const s={destination:this.resolveDestination(e,n),parent:this.resolveParent(e,n),identifier:t.identifier};return e===n.length-1&&Object.assign(s,{connectFromChannel:this.props.connectFromChannel||0,connectToChannel:this.props.connectToChannel||0}),i.a.cloneElement(t.component,s)}render(){this.foundFirstConnectableType=!1;const t=i.a.Children.toArray(this.props.children),e=(this.customChildren||t).filter(t=>null!==t&&t!==[]).map(this.createIdentifiedChild,this).map(this.createEmbeddableChild,this);return this.context.debug?i.a.createElement("li",null,i.a.createElement("ul",null,e)):e}}class f extends a{constructor(t){super(t),this.inputs=[]}componentWillMount(){super.componentWillMount(),this.context.nodes.set(this.props.identifier,this.inputs)}componentWillUpdate(t,e){this.props.identifier!==t.identifier&&(this.context.nodes.delete(this.props.identifier),this.context.nodes.set(t.identifier,this.inputs))}render(){for(;this.inputs.length;)this.inputs.pop();const t=i.a.Children.toArray(this.props.children).filter(t=>null!==t&&t!==[]).map(t=>({component:t,identifier:Symbol(t.type.name+Date.now())})).map((t,e,n)=>{if(!a.isPrototypeOf(t.component.type))return t.component;const s=t.component.type;a.isPrototypeOf(s)&&u(t.component)&&this.inputs.push(t.identifier);const[o,r]=["connectFromChannel","connectToChannel"].map(l(t.component,this)),p={destination:this.props.destination,identifier:t.identifier,connectFromChannel:o,connectToChannel:r};return i.a.cloneElement(t.component,p)});if(!this.inputs.length){const t=this.props.destination();t instanceof Array?this.inputs.push(...t):this.inputs.push(t)}return this.context.debug?i.a.createElement("li",null,i.a.createElement("strong",null,"RSplit"),i.a.createElement("ul",null,t)):t}}class y extends a{constructor(t){super(t),this.inputs=[]}componentWillMount(){super.componentWillMount(),this.context.nodes.set(this.props.identifier,this.inputs)}componentWillUpdate(t,e){this.props.identifier!==t.identifier&&(this.context.nodes.delete(this.props.identifier),this.context.nodes.set(t.identifier,this.inputs))}render(){for(;this.inputs.length>0;)this.inputs.pop();const t=i.a.Children.toArray(this.props.children).filter(t=>null!==t&&t!==[]).map(t=>({component:t,identifier:Symbol(t.type.name+Date.now())})).map((t,e,n)=>{t.component.type;a.isPrototypeOf(t.component.type)&&u(t.component)&&this.inputs.push(t.identifier);const s={destination:()=>{let e=this.props.destination();const n=this.context.nodes.get(t.identifier);return e instanceof Array||(e=[e]),e.concat([n])},identifier:t.identifier};return i.a.cloneElement(t.component,s)});if(0===this.inputs.length){const t=this.props.destination();t instanceof Array?this.inputs.push(...t):this.inputs.push(t)}return this.context.debug?i.a.createElement("li",null,i.a.createElement("strong",null,"RCycle"),i.a.createElement("ul",null,t)):t}}class x extends m{renderGraph(){return null}addKeys(t,e){return i.a.cloneElement(t,{key:e})}render(){return this.customChildren=[this.renderGraph()].map(this.addKeys),super.render()}}class b extends h{constructor(t){super(t),this.params={channelCount:1}}getConnectionArguments(t,e,n){const s=n?t[n]:t,i=e%this.props.channelCount,o=isNaN(this.props.connectToChannel)?0:this.props.connectToChannel;return[s].concat(n?[]:[i,o])}componentWillMount(){super.componentWillMount(),this.node||(this.node=this.context.audio.createChannelSplitter(this.props.channelCount),this.context.nodes.set(this.props.identifier,this.node)),this.updateParams=this.updateParams.bind(this),this.updateParams(this.props)}}class P extends h{constructor(t){super(t),this.params={channelCount:1}}componentWillMount(){super.componentWillMount(),this.node||(this.node=this.context.audio.createChannelMerger(this.props.channelCount),this.context.nodes.set(this.props.identifier,this.node)),this.updateParams=this.updateParams.bind(this),this.updateParams(this.props)}}class C extends a{render(){const t=i.a.Children.toArray(this.props.children).slice(0,this.props.channelCount).map((t,e)=>{const n={connectFromChannel:0,connectToChannel:t.props.connectToChannel||e};return i.a.cloneElement(t,n)});return i.a.createElement(m,{identifier:this.props.identifier,destination:this.props.destination},i.a.createElement(b,{channelCount:this.props.channelCount}),i.a.createElement(f,null,t),i.a.createElement(P,{channelCount:this.props.channelCount}))}}class g extends h{constructor(t){super(t),this.params={fftSize:this.props.fftSize,minDecibels:this.props.minDecibels,maxDecibels:this.props.maxDecibels,smoothingTimeConstant:this.props.smoothingTimeConstant}}componentWillMount(){super.componentWillMount(),this.node||(this.node=this.context.audio.createAnalyser(),this.context.nodes.set(this.props.identifier,this.node)),this.updateParams=this.updateParams.bind(this),this.updateParams(this.props)}render(){const t=Object.freeze({getFloatFrequencyData:t=>this.node.getFloatFrequencyData(t),getByteFrequencyData:t=>this.node.getByteFrequencyData(t),getFloatTimeDomainData:t=>this.node.getFloatTimeDomainData(t),getByteTimeDomainData:t=>this.node.getByteTimeDomainData(t),frequencyBinCount:this.node.frequencyBinCount});return this.props.children(t),super.render()}}g.propTypes={children:r.a.func.isRequired};class W extends h{constructor(t){super(t),this.params=Object.assign({},this.props)}componentWillMount(){super.componentWillMount(),this.node||(this.node=new AudioWorkletNode(this.context.audio,this.props.worklet),this.context.nodes.set(this.props.identifier,this.node)),this.updateParams=this.updateParams.bind(this),this.updateParams(this.props)}}class E extends h{constructor(t){super(t),this.params={frequency:t.frequency,detune:t.detune,Q:t.Q,gain:t.gain,type:t.type}}componentWillMount(){super.componentWillMount(),this.node||(this.node=this.context.audio.createBiquadFilter(),this.context.nodes.set(this.props.identifier,this.node)),this.updateParams=this.updateParams.bind(this),this.updateParams(this.props)}render(){if("function"==typeof this.props.children){const t=Object.freeze({getFrequencyResponse:(t,e,n)=>this.node.getFrequencyResponse(t,e,n)});this.props.children(t)}return super.render()}}E.propTypes={children:r.a.func};class M extends d{constructor(t){super(t),this.readyToPlay=!1,this.playbackScheduled=!1,this.onEnded=this.onEnded.bind(this),this.schedule=this.schedule.bind(this)}onEnded(){this.playbackScheduled=!1,this.instantiateNode(),this.connectToAllDestinations(this.props.destination,this.node)}schedule(){const t="number"==typeof this.props.start&&this.readyToPlay&&!this.playbackScheduled&&("number"!=typeof this.props.stop||this.props.start<this.props.stop),e="number"==typeof this.props.stop;t&&(this.node.start(this.props.start||0,this.props.offset||0,this.props.duration),this.playbackScheduled=!0),e&&this.node.stop(this.props.stop)}shouldStartWithPropsChange(){return!1}componentDidMount(){super.componentDidMount(),this.schedule()}componentDidUpdate(t,e){super.componentDidUpdate(t,e),(t.start!==this.props.start||t.stop!==this.props.stop||this.shouldStartWithPropsChange(t,this.props))&&this.schedule()}}class v extends M{constructor(t){super(t),this.params={buffer:t.buffer||null,detune:t.detune||0,loop:t.loop||!1,loopStart:t.loopStart||0,loopEnd:t.loopEnd||0,playbackRate:t.playbackRate||1},this.onEnded=this.onEnded.bind(this),this.instantiateNode=this.instantiateNode.bind(this)}instantiateNode(){this.node||(this.node=this.context.audio.createBufferSource(),this.node.addEventListener("ended",this.onEnded),this.context.nodes.set(this.props.identifier,this.node)),this.updateParams=this.updateParams.bind(this),this.updateParams(this.props)}onEnded(t){super.onEnded(t),this.instantiateNode(),this.connectToAllDestinations(this.props.destination,this.node),this.props.onEnded&&this.props.onEnded(t)}componentWillMount(){super.componentWillMount(),this.instantiateNode()}componentDidMount(){this.readyToPlay=!!this.props.buffer,super.componentDidMount()}shouldStartWithPropsChange(t,e){return t.buffer!==e.buffer}componentDidUpdate(t,e){this.readyToPlay=!!this.props.buffer,super.componentDidUpdate(t,e)}}class T extends M{constructor(t){super(t),this.params={offset:t.offset},this.instantiateNode=this.instantiateNode.bind(this),this.readyToPlay=!0,this.onEnded=this.onEnded.bind(this)}onEnded(t){super.onEnded(t),this.props.onEnded&&this.props.onEnded(t)}instantiateNode(){this.node&&!1!==this.playbackScheduled||(this.node=this.context.audio.createConstantSource(),this.node.addEventListener("ended",this.onEnded),this.context.nodes.set(this.props.identifier,this.node)),this.updateParams=this.updateParams.bind(this),this.updateParams(this.props)}componentWillMount(){super.componentWillMount(),this.instantiateNode()}}class R extends h{constructor(t){super(t),this.params={buffer:t.buffer||null,normalize:t.normalize||!0}}componentWillMount(){super.componentWillMount(),this.node||(this.node=this.context.audio.createConvolver(),this.context.nodes.set(this.props.identifier,this.node)),this.updateParams=this.updateParams.bind(this),this.updateParams(this.props)}}class D extends h{constructor(t){super(t),this.params={delayTime:t.delayTime}}componentWillMount(){super.componentWillMount(),this.node||(this.node=this.context.audio.createDelay(),this.context.nodes.set(this.props.identifier,this.node)),this.updateParams=this.updateParams.bind(this),this.updateParams(this.props)}}class A extends h{constructor(t){super(t),this.params={threshold:t.threshold||-24,knee:t.knee||30,ratio:t.ratio||12,attack:t.attack||.003,release:t.release||.25}}componentWillMount(){super.componentWillMount(),this.node||(this.node=this.context.audio.createDynamicsCompressor(),this.context.nodes.set(this.props.identifier,this.node)),this.updateParams=this.updateParams.bind(this),this.updateParams(this.props)}}class S extends h{constructor(t){super(t),this.params={gain:this.props.gain}}componentWillMount(){super.componentWillMount(),this.node||(this.node=this.context.audio.createGain(),this.context.nodes.set(this.props.identifier,this.node)),this.updateParams=this.updateParams.bind(this),this.updateParams(this.props)}}class w extends h{constructor(t){super(t),this.params={}}componentWillMount(){super.componentWillMount(),this.node||(this.node=this.context.audio.createIIRFilter({feedback:this.props.feedback,feedforward:this.props.feedforward}),this.context.nodes.set(this.props.identifier,this.node)),this.updateParams=this.updateParams.bind(this),this.updateParams(this.props)}render(){if("function"==typeof this.props.children){const t=Object.freeze({getFrequencyResponse:(t,e,n)=>this.node.getFrequencyResponse(t,e,n)});this.props.children(t)}return super.render()}}w.propTypes={children:r.a.func};class O extends d{constructor(t){super(t),this.params={},this.createNode=this.createNode.bind(this)}createNode(){this.node=this.context.audio.createMediaElementSource(this.props.element),this.context.nodes.set(this.props.identifier,this.node)}componentWillMount(){super.componentWillMount(),this.node||this.createNode(),this.updateParams=this.updateParams.bind(this),this.updateParams(this.props)}componentWillReceiveProps(t){t.element!==this.props.element&&this.createNode()}}class N extends d{constructor(t){super(t),this.params={buffer:t.buffer||null},this.createNode=this.createNode.bind(this)}createNode(){this.node=this.context.audio.createMediaStreamSource(this.props.stream),this.context.nodes.set(this.props.identifier,this.node)}componentWillMount(){super.componentWillMount(),this.node||this.createNode(),this.updateParams=this.updateParams.bind(this),this.updateParams(this.props)}componentWillReceiveProps(t){t.stream!==this.props.stream&&this.createNode()}}class F extends M{constructor(t){super(t),this.params={frequency:t.frequency,detune:t.detune,type:t.type,periodicWave:t.periodicWave},this.instantiateNode=this.instantiateNode.bind(this),this.readyToPlay=!0,this.onEnded=this.onEnded.bind(this)}onEnded(t){super.onEnded(t),this.props.onEnded&&this.props.onEnded(t)}instantiateNode(){this.node&&!1!==this.playbackScheduled||(this.node=this.context.audio.createOscillator(),this.node.addEventListener("ended",this.onEnded),this.props.periodicWave&&this.node.setPeriodicWave(this.props.periodicWave),this.context.nodes.set(this.props.identifier,this.node)),this.updateParams=this.updateParams.bind(this),this.updateParams(this.props)}componentWillMount(){super.componentWillMount(),this.instantiateNode()}componentWillReceiveProps(t){super.componentWillReceiveProps(t),this.props.periodicWave!==t.periodicWave&&this.node.setPeriodicWave(t.periodicWave)}}class k extends h{constructor(t){super(t),this.params={panningModel:this.props.panningModel,distanceModel:this.props.distanceModel,refDistance:this.props.refDistance,maxDistance:this.props.maxDistance,rolloffFactor:this.props.rolloffFactor,coneInnerAngle:this.props.coneInnerAngle,coneOuterAngle:this.props.coneOuterAngle,coneOuterGain:this.props.coneOuterGain,positionX:this.props.positionX,positionY:this.props.positionY,positionZ:this.props.positionZ,orientationX:this.props.orientationX,orientationY:this.props.orientationY,orientationZ:this.props.orientationZ}}componentWillMount(){super.componentWillMount(),this.node||(this.node=this.context.audio.createPanner(),this.context.nodes.set(this.props.identifier,this.node)),this.updateParams=this.updateParams.bind(this),this.updateParams(this.props)}}class q extends h{constructor(t){super(t),this.params={pan:t.pan}}componentWillMount(){super.componentWillMount();this.props;this.node||(this.node=this.context.audio.createStereoPanner(),this.context.nodes.set(this.props.identifier,this.node)),this.updateParams=this.updateParams.bind(this),this.updateParams(this.props)}}class j extends h{constructor(t){super(t),this.params={curve:t.curve||null,oversample:t.oversample||"none"}}componentWillMount(){super.componentWillMount(),this.node||(this.node=this.context.audio.createWaveShaper(),this.context.nodes.set(this.props.identifier,this.node)),this.updateParams=this.updateParams.bind(this),this.updateParams(this.props)}}n.d(e,"RAnalyser",function(){return g}),n.d(e,"RAudioContext",function(){return p}),n.d(e,"RAudioWorklet",function(){return W}),n.d(e,"RBiquadFilter",function(){return E}),n.d(e,"RBufferSource",function(){return v}),n.d(e,"RChannelMerger",function(){return P}),n.d(e,"RChannelSplitter",function(){return b}),n.d(e,"RConvolver",function(){return R}),n.d(e,"RConstantSource",function(){return T}),n.d(e,"RCycle",function(){return y}),n.d(e,"RDelay",function(){return D}),n.d(e,"RDynamicsCompressor",function(){return A}),n.d(e,"RGain",function(){return S}),n.d(e,"RIIRFilter",function(){return w}),n.d(e,"RMediaElementSource",function(){return O}),n.d(e,"RMediaStreamSource",function(){return N}),n.d(e,"ROscillator",function(){return F}),n.d(e,"RPanner",function(){return k}),n.d(e,"RPipeline",function(){return m}),n.d(e,"RSplit",function(){return f}),n.d(e,"RSplitChannels",function(){return C}),n.d(e,"RStereoPanner",function(){return q}),n.d(e,"RWaveShaper",function(){return j}),n.d(e,"RExtensible",function(){return x})}])});